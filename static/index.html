<!DOCTYPE html>
<html>
<head>
    <title>Stock Ticker Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.3/chart.umd.min.js"></script>
</head>
<body>
    <h1>Live Stock Prices</h1>
    <canvas id="priceChart" width="400" height="200"></canvas>
    <p id="status"></p>
    <script>
        const ws = new WebSocket("ws://127.0.0.1:8000/ws?symbol=MSFT");
        const ctx = document.getElementById("priceChart").getContext("2d");
        const chart = new Chart(ctx, {
            type: "line",
            data: {
                labels: [],
                datasets: [{
                    label: "MSFT Price",
                    data: [],
                    borderColor: "#007bff",
                    fill: false
                }]
            },
            options: { scales: { x: { type: "time" } } }
        });
        const status = document.getElementById("status");

        ws.onopen = function() {
            status.textContent = "Connected to WebSocket";
        };

        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.price) {
                chart.data.labels.push(new Date(data.timestamp));
                chart.data.datasets[0].data.push(data.price);
                if (chart.data.labels.length > 10) {
                    chart.data.labels.shift();
                    chart.data.datasets[0].data.shift();
                }
                chart.update();
                status.textContent = `Last Price: ${data.price} at ${data.timestamp}`;
            } else {
                status.textContent = data.message || "No data available";
            }
        };

        ws.onerror = function(error) {
            status.textContent = "WebSocket error: " + error.message;
        };

        ws.onclose = function() {
            status.textContent = "WebSocket disconnected";
        };
    </script>
</body>
</html>